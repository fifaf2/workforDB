
-- ============================================================================
-- ЗАДАНИЕ 1
-- Вывести информацию обо всех деталях, поставляемых для указанного изделия
-- (например, 'J4') более чем одним поставщиком.
-- ============================================================================

SELECT p.*
FROM public.p
JOIN public.spj ON p.num_det = spj.num_det
WHERE spj.num_izdel = 'J4'
GROUP BY p.num_det, p.name, p.color, p.weight, p.city
HAVING COUNT(DISTINCT spj.num_post) > 1;


-- ============================================================================
-- ЗАДАНИЕ 2
-- Увеличить рейтинг поставщика, выполнившего наибольшую поставку
-- некоторой детали (например, 'P3'), на указанную величину (например, 10).
-- ============================================================================

UPDATE public.s
SET score = score + 10
WHERE num_post IN (
    SELECT num_post
    FROM public.spj
    WHERE num_det = 'P3'
      AND count = (
          SELECT MAX(count)
          FROM public.spj
          WHERE num_det = 'P3'
      )
);


-- ============================================================================
-- ЗАДАНИЕ 3
-- Изменить цвет самой тяжелой детали на указанный (например, 'Серебристый').
-- ============================================================================

UPDATE public.p
SET color = 'Серебристый' -- <-- УКАЖИТЕ НОВЫЙ ЦВЕТ
WHERE weight = (
    SELECT MAX(weight)
    FROM public.p
);


-- ============================================================================
-- ЗАДАНИЕ 4
-- Увеличить рейтинг поставщика, выполнившего больший суммарный объем поставок,
-- на указанную величину (например, 20).
-- ============================================================================

UPDATE public.s
SET score = score + 20
WHERE num_post IN (
    SELECT num_post
    FROM public.spj
    GROUP BY num_post
    HAVING SUM(count) = (
        SELECT MAX(total_sum)
        FROM (
            SELECT SUM(count) as total_sum
            FROM public.spj
            GROUP BY num_post
        ) as subquery
    )
);